% easychair.tex,v 3.5 2017/03/15

\documentclass{easychair}
%\documentclass[EPiC]{easychair}
%\documentclass[EPiCempty]{easychair}
%\documentclass[debug]{easychair}
%\documentclass[verbose]{easychair}
%\documentclass[notimes]{easychair}
%\documentclass[withtimes]{easychair}
%\documentclass[a4paper]{easychair}
%\documentclass[letterpaper]{easychair}

\usepackage{doc}
\usepackage{tikz}
\usepackage{tikzsymbols}
\usetikzlibrary{arrows}

\usepackage[firstpageonly=false, color={[gray]{0.5}},
   scale=2.0, text=DRAFT]{draftwatermark}
% -------------------------------
%%%% For Alectryon

\usepackage{texments}
%%% for movies by alectryon
\usepackage{../movies/snippets/assets/alectryon}
\usepackage{../movies/snippets/assets/pygments}
%%% One hypothesis per line 
\makeatletter
\renewcommand{\alectryon@hyps@sep}{\alectryon@nl}
\makeatother

%%% \snippets{A,B,C,…} inputs a series of snippets as one block (with \itemsep
%%% between them).  A, B, C should be paths to files in movies/snippets/.
\usepackage{etoolbox}
\makeatletter
\newcommand{\inputsnippets}[1]
  {{\setlength{\itemsep}{1pt}\setlength{\parsep}{0pt}% Adjust spacing
    \alectryon@copymacros\begin{io}
      \forcsvlist{\item\@inputsnippet}{#1}
    \end{io}}}
\let\input@old\input % Save definition of \input
\newcommand{\@inputsnippet}[1]
  {{\renewenvironment{alectryon}{}{}% Skip \begin{alectryon} included in snippet
    \input@old{../movies/snippets/#1}}}
\makeatother

%---------------------------- 
\newcommand{\canonseq}[2]{\mbox{$\{#1\}(#2)$}}

\newtheorem{todo}{To do}
\usepackage{amsfonts, afterpage}

\newcommand{\easychair}{\textsf{easychair}}
\newcommand{\miktex}{MiK{\TeX}}
\newcommand{\texniccenter}{{\TeX}nicCenter}
\newcommand{\makefile}{\texttt{Makefile}}
\newcommand{\latexeditor}{LEd}


%\makeindex

%% Front Matter
%%
% Regular title as in the article class.
%
\title{Hydras and Cie (Draft) \\
  Variations on Kirby \& Paris' hydra battles and ordinal numbers in Coq}



\author{
Pierre Castéran \inst{1}
\and
    Jérémy Damour \inst{2}
\and
Karl Palmskog \inst{2}
\and Clément Pit-Claudel \inst{2}
\and Théo Zimmermann %\inst{5}
}


\institute{
 LaBRI, Université Bordeaux \\
  \email{pierre.casteran@labri.fr}
\and
   Ask for agreement !
 }



\authorrunning{Castéran, Damour, Palmskog, Pit-Claudel and Zimmermann}

\titlerunning{Hydras and Cie}

\begin{document}

\maketitle


\begin{abstract}
  \begin{todo}
 \dots
  \end{todo}
\end{abstract}


% \setcounter{tocdepth}{2}
% {\small
% \tableofcontents}


%------------------------------------------------------------------------------
\section{Introduction}
\label{sect:introduction}
Hydra games (also known as \emph{Hydra battles}) appear in an article published in 1982 by two mathematicians, 
Laurie Kirby and Jeff Paris~\cite{KP82}: \emph{Accessible Independence Results for Peano Arithmetic}.
This article describes a game between two players: Hercules and a hydra.
A short description  can be found in Andrej Bauer's blogpost~\cite{bauer2008} as well as a simulator~\cite{BauerHydra}.

In a few words:
\begin{itemize}
\item A hydra is a finite tree, traditionnaly presented with the root at the bottom, the leaves of which are called \emph{heads}.
\item At every round, Hercules chops off one head of the hydra. If the head is at a distance greater or equal than 2 from the root,
  then some sub-tree $h$ of the hydra is copied a certain amount $i$ of times. The number $i$ of copies and the copied sub-hydra $h$ may depend of the considered variant of the game
  or the time elapsed since the beginning of the fight.
\end{itemize}


Kirby and Paris prove the following theorems, applying
combinatorial results about ordinal numbers by Jussi Ketonen and Robert Solovay~\cite{KS81}.

\begin{quote}
\begin{description}
\item[$(1)$] In the Hydra game, every strategy is a winning strategy for Hercules.
  \item[$(2)$] The theorem $(1)$ cannot be proved in Peano Arithmetic.
\end{description}
\end{quote}

The contrast between the simplicity of the statements above and the complexity of the mathematical tools used to prove these theorems: ordinal numbers, rapidly growing hierarchies of fast growing functions, etc., convinced us that it is a good thema for a commented library of formal proofs.

The benefits we would expect from this development are multiple.
\begin{itemize}
\item We present complete proof scripts which can be consulted and replayed by the reader.
\item Complex formalisations and proofs are explained in an
  electronic book~\cite{HydraBook}. Whenever various reasonable choices exist, we try to present and compare the alternatives. Reciprocally, we provide ``concrete'' examples of several formaisation end proof techniques: operational type classes, functions defined by  equations, etc.
\item It may be used as a library on ordinal numbers, for instance for proving termination properties.
  \end{itemize}

 Prior stages of this project have already been presented at
 JFLA~\cite{JFLA2018paper}.
We present the recent evolutions of the library: new results, interaction within the Coq-Community project~\cite{CoqCommunity}, and documentation generated with Alectryon~\cite{alectryonpaper, alectryongithub}.

\section{New results}
In order to make evident how long a hydra battle can be,
one may consider a deterministic variant of the game,
``compute'' the number of steps of the battles, and thus obtain a minoration of the general case.

The variant we consider is the same as 
in~\cite{KP82, bauer2008, BauerHydra}. 


 \begin{itemize}
 \item The game starts at an arbitrary initial step $i\in\mathbb{N}$.
   
   \item The hydra grows $n$ copies at step $n$ of the game.
 \item  The initial hydra is the graphical representation of an ordinal  $\alpha<\epsilon_0$  in Cantor normal form (See for instance Fig~\ref{fig:iota-example}). 
 \item Hercules always chops off the rightmost head of the hydra (which is always one of the lowest heads).
 \end{itemize}
 It mathematical terms, if at step $n$ the hydra is associated with the ordinal $\alpha$, at step $n+1$ it is associated with
 $\canonseq{\alpha}{n+1}$, the $(n+1)$th element of the canonical sequence of $\alpha$~\cite{KS81}.
 
 

   \begin{figure}[htb]
\centering
\begin{tikzpicture}[very thick, scale=0.3]
\node (foot) at (10,0) {$\bullet$};
\node (N1) at (2,2) {$\bullet$};
\node (N2) at (10,2) {$\bullet$};
\node (N22) at (7,2) {$\bullet$};
\node (N3) at (14,2) {$\bullet$};
\node (N4) at (18,2) {$\Smiley[2][green]$};
\node (N5) at (0,4) {$\bullet$};
\node (N6) at (2,5) {$\Smiley[2][green]$};
\node (N7) at (4,6) {$\Smiley[2][green]$};
\node (N88) at (7,4) {$\bullet$};
\node (N8) at (10,4) {$\bullet$};
\node (N9) at (14,6) {$\Smiley[2][green]$};
\node (N10) at (0,8) {$\Smiley[2][green]$};
\node (N11) at (10,7) {$\Smiley[2][green]$};
\node (N111) at (7,7) {$\Smiley[2][green]$};
\draw (foot) to [bend left=10] (N1);
\draw (foot) -- (N2);
\draw (foot) -- (N22);
\draw (foot) -- (N3);
\draw (foot) -- (N4);
\draw (N1) to  (N5);
\draw (N1) to   [bend left=10] (N6);
\draw (N1) to   [bend right=20] (N7);
\draw (N2) to  (N8);
\draw (N22) to  (N88);
\draw (N8) to  (N11);
\draw (N88) to  (N111);
\draw (N3) to  (N9);
\draw (N5) to  (N10);
\end{tikzpicture}
\caption{The hydra associated with $\omega^{\omega+2}+\omega^\omega \times 2 + \omega + 1$ \label{fig:iota-example}}

\end{figure}

Let $\alpha<\epsilon_0$ be an ordinal.
Using the \texttt{coq-equations} plug-in~\cite{sozeau:hal-01671777}, we define the function which returns the number of steps of the battle starting at configuration $(i,\alpha)$ for  any $i\in\mathbb{N}$.
We prove that this number is greater or equal than
$H'_\alpha(i)-i$, where $H'$ is a slight variant of the Wainer Hardy hierarchy of rapidly growing functions~\cite{BW85, KS81, Promel2013, Wainer1970}, defined in Fig.~\ref{fig:Hprime} and
\ref{fig:HprimeCoq}.

\begin{figure}[h]
  \centering
  \begin{itemize}
\item If $\alpha=0$, then $H'_\alpha (k)= k$ for any natural number $k$.
\item If $\alpha=\beta+1$, then 
$H'_\alpha(k)=H'_\beta(k+1)$ for any $k \in \mathbb{N}$
\item If $\alpha$ is a limit ordinal, then 
$H'_\alpha(k) = H'_{(\canonseq{\alpha}{k+1})}(k)$ for any $k\in \mathbb{N}$.
\end{itemize}
\caption{The rapidly growing hierarchy $H'$}
\label{Hprime}
\end{figure}

\begin{figure}[h]
  \centering
  \inputsnippets{Hprime/HprimeDef}
  \caption{$H'$: definition in \emph{Coq}}
  \label{fig:HprimeCoq}
\end{figure}

From this result, we infer that, for a given $\alpha$, the considered function is not primitive recursive.


 
\section{Main features}

% \begin{eqnarray}
%   \label{eq:1}
%   \omega+42+\omega^2&=&\omega^2
% \end{eqnarray}


% We also implemented in \emph{Coq} the axiomatic definition of the set $\mathbb{O}$ of countable ordinals by Schütte~\cite{schutte, PCiota}.

% The proof of $\omega+42+\omega^2=\omega^2$ is no more computational, but use the following definitions and properties.

% \begin{itemize}
% \item Any set of countable ordinals can be enumerated by a function defined on a segment $[0, \alpha)$ of countable ordinals.
% \item Let $\alpha$ and $\beta$ be (countable) ordinals. Then $\alpha+\beta$ is the $\beta$-th element of the enumeration of the set of countable ordinals greater or equal than $\alpha$.
% \item Let $\phi_0$ be the enumeration of the set of \emph{additive principal ordinals}
%   $\{\alpha\in\mathbb{O}| \forall \beta\in \mathbb{O}, \beta+\alpha=\alpha\}$. Then $\omega^\alpha$ is just a notation for
%   $\phi_0(\alpha)$.
% \end{itemize}




\begin{todo}
  Comment the multiple views of a same mathematical object:
  \begin{itemize}
 
  \item Bridge lemmas (relative correctness of different representations).
    \item The user/reader may compare  different proofs of the same result (For instance the equality $\omega+42+\omega^2= \omega^2$). \emph{Example in Figures~\ref{fig:Ex42E0} and \ref{fig:Ex42-schutte}}.
  \end{itemize}
\end{todo}



\section{The Coq-community ecosystem}


\section{Documentation with Alectryon}

We present two ~examples of the documentation generated with Alectryon~\cite{alectryonpaper}: A simple proof by computation (Fig.~\ref{fig:Ex42E0}), and a longer proof where only the main steps are displayed, interleaved with plain text.

  \begin{figure}[h]
    \centering
    \fbox{
      \begin{minipage}[h]{1.0\linewidth}
        \inputsnippets{E0/Ex42}
      \end{minipage}}
    \caption{A simple proof by computation}
    \label{fig:Ex42E0}
  \end{figure}



%\afterpage{\clearpage}

\begin{figure}[th]
  \centering
  
  
\label{fig:Ex42-schutte}
\fbox{\begin{minipage}[h]{1.0\linewidth}
  Let us prove again the equality $\omega+42+\omega^2= \omega^2$. Let us recall that $\omega^2$ is an abbreviation of $\phi_0(2)$,
\emph{i.e} the third  additive principal ordinal.

\inputsnippets{Schutte/Ex42a}


Our proof is very different from the computational proof of Fig\ref{fig:Ex42E0}.
By definition of additive principal ordinals, 
it suffices to prove the inequality $\omega+42< \phi_0(2)$.

\inputsnippets{Schutte/Ex42b}

Since the set \textit{AP} of additive principals  is closed under addition
(by Lemma \textit{AP\_plus\_closed}), it suffices to prove the inequalities $\omega<\phi_0(2)$ and $42<\phi_0(2)$.

\inputsnippets{Schutte/Ex42d, Schutte/Ex42c, Schutte/Ex42e}

\end{minipage}
}
\caption{A proof interleaved with text (from the book)}
  \label{fig:Ex42b}
\end{figure}

\section{Conclusion and perspectives}

\begin{todo}
  \begin{itemize}
  \item  Soundness (correction, maintenance) of the Alectryon generated doc.
  \item Communications between co-maintained libraries
          (Ackermann, Gaia, etc.)
  \item Work destined both to Coq-users and people interested in discrete math ?
  \end{itemize}
\end{todo}


\subsection{Perspectives}


The Gaia project~\cite{Gaia}, also maintained on \textit{Coq-community} contains a development by José Grimm~\cite{grimm:hal-00911710}. This library -- dedicated  to the implementaion in \textit{Coq (SSreflect)} of books from  Bourbaki's Elements of Mathematics --- contains a generalization of two types of ordinals (\texttt{T1} for the ordinal $\epsilon_0$ and
\texttt{T2} for $\Gamma_0$) to a larger ordinal defined by Ackermann, and relates these data structures with Bourbaki's set theory.
It is interesting to note that both libraries \textit{Gaia} and \textit{hydra-battles} contain their own (isomorphic) definitions of
\texttt{T1} and \texttt{T2}, originated in~\cite{CantorContrib}.
The types --- defined in different modules --- cannot be considered as equal. Even more, some operations like addition, multiplication, etc. have now different definitions.

It would be interesting to build a library which could be used as a gate giving access to both the combinatorial results of \textit{hydra-battles} and the set-theoretic content of \textit{Gaia}.
For instance, the associativity of multiplication of ordinals below $\epsilon_0$, already proven in \textit{Gaia} could be tranferred ``for free'' to the data structures of \textit{hydra-battles}, thanks to the isomorphism between both implementations.



%\section{Acknowledgments}
%\label{sect:acks}



\label{sect:bib}
\bibliographystyle{plain}
%\bibliographystyle{alpha}
%\bibliographystyle{unsrt}
%\bibliographystyle{abbrv}
\bibliography{../thebib}


\end{document}

